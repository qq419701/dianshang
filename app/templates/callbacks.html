{% extends "base.html" %}
{% block title %}å›è°ƒæ—¥å¿— â€” ç”µå•†å¹³å°ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<h2 style="margin-bottom: 20px; font-size: 20px;">ğŸ“ å›è°ƒæ—¥å¿—</h2>

<!-- ç­›é€‰æ  -->
<div class="card">
    <form method="GET" action="/admin/callbacks" class="search-bar">
        <select name="type">
            <option value="0" {% if callback_type == 0 %}selected{% endif %}>å…¨éƒ¨ç±»å‹</option>
            <option value="1" {% if callback_type == 1 %}selected{% endif %}>é€šç”¨äº¤æ˜“å›è°ƒ</option>
            <option value="2" {% if callback_type == 2 %}selected{% endif %}>ç›´å……å›è°ƒ</option>
            <option value="3" {% if callback_type == 3 %}selected{% endif %}>å¡å¯†å›è°ƒ</option>
        </select>
        <button type="submit" class="btn btn-primary">ğŸ” ç­›é€‰</button>
    </form>
</div>

<!-- æ—¥å¿—åˆ—è¡¨ -->
<div class="card">
    <h2>å›è°ƒè®°å½•åˆ—è¡¨</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>è®¢å•ID</th>
                <th>å›è°ƒç±»å‹</th>
                <th>å›è°ƒæ–¹å‘</th>
                <th>ç»“æœç </th>
                <th>ç»“æœä¿¡æ¯</th>
                <th>é‡è¯•æ¬¡æ•°</th>
                <th>æ—¶é—´</th>
            </tr>
        </thead>
        <tbody>
            {% for cb in callbacks %}
            <tr>
                <td>{{ cb.id }}</td>
                <td>{{ cb.order_id }}</td>
                <td>
                    {% if cb.callback_type == 1 %}
                        <span class="badge badge-info">é€šç”¨äº¤æ˜“</span>
                    {% elif cb.callback_type == 2 %}
                        <span class="badge badge-info">ç›´å……</span>
                    {% elif cb.callback_type == 3 %}
                        <span class="badge badge-info">å¡å¯†</span>
                    {% endif %}
                </td>
                <td>
                    {% if cb.callback_direction == 1 %}
                        <span class="badge badge-warning">äº¬ä¸œâ†’æˆ‘æ–¹</span>
                    {% elif cb.callback_direction == 2 %}
                        <span class="badge badge-success">æˆ‘æ–¹â†’äº¬ä¸œ</span>
                    {% endif %}
                </td>
                <td>
                    {% if cb.result_code == '0' or cb.result_code == '100' %}
                        <span class="badge badge-success">{{ cb.result_code }}</span>
                    {% elif cb.result_code == 'EXCEPTION' %}
                        <span class="badge badge-danger">å¼‚å¸¸</span>
                    {% else %}
                        <span class="badge badge-warning">{{ cb.result_code or '-' }}</span>
                    {% endif %}
                </td>
                <td>{{ cb.result_message or '-' }}</td>
                <td>{{ cb.retry_count }}</td>
                <td>{{ cb.create_time.strftime('%Y-%m-%d %H:%M:%S') if cb.create_time else '-' }}</td>
            </tr>
            {% endfor %}
            {% if not callbacks %}
            <tr>
                <td colspan="8" style="text-align: center; color: #999; padding: 40px;">æš‚æ— å›è°ƒæ—¥å¿—</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <!-- åˆ†é¡µ -->
    {% if pagination.pages > 1 %}
    <div class="pagination">
        {% if pagination.has_prev %}
        <a href="?page={{ pagination.prev_num }}&type={{ callback_type }}">ä¸Šä¸€é¡µ</a>
        {% endif %}

        {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if p %}
                <a href="?page={{ p }}&type={{ callback_type }}" class="{% if p == pagination.page %}active{% endif %}">{{ p }}</a>
            {% else %}
                <span style="padding: 6px;">...</span>
            {% endif %}
        {% endfor %}

        {% if pagination.has_next %}
        <a href="?page={{ pagination.next_num }}&type={{ callback_type }}">ä¸‹ä¸€é¡µ</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
