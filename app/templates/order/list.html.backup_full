{% extends "layouts/base.html" %}
{% block title %}è®¢å•ç®¡ç†{% endblock %}

{% block content %}
<div class="card">
    <div class="card-title">
        ğŸ“¦ è®¢å•ç®¡ç†
        <div style="float: right;">
            <span class="badge">æ€»è®¡: {{ pagination.total }} ä¸ªè®¢å•</span>
        </div>
    </div>

    <!-- æœç´¢å’Œç­›é€‰ -->
    <form method="GET" class="mb-4">
        <div class="form-row">
            <div class="form-group">
                <input type="text" name="keyword" class="form-control" placeholder="è®¢å•å·/äº¬ä¸œè®¢å•å·/å•†å“" value="{{ request.args.get('keyword', '') }}">
            </div>
            <div class="form-group">
                <select name="order_status" class="form-control">
                    <option value="">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="0" {{ 'selected' if request.args.get('order_status') == '0' }}>å¾…å¤„ç†</option>
                    <option value="1" {{ 'selected' if request.args.get('order_status') == '1' }}>å¤„ç†ä¸­</option>
                    <option value="2" {{ 'selected' if request.args.get('order_status') == '2' }}>å·²å®Œæˆ</option>
                    <option value="3" {{ 'selected' if request.args.get('order_status') == '3' }}>å·²å–æ¶ˆ</option>
                    <option value="4" {{ 'selected' if request.args.get('order_status') == '4' }}>å·²é€€æ¬¾</option>
                    <option value="5" {{ 'selected' if request.args.get('order_status') == '5' }}>å¼‚å¸¸</option>
                </select>
            </div>
            <div class="form-group">
                <select name="shop_id" class="form-control">
                    <option value="">å…¨éƒ¨åº—é“º</option>
                    {% for shop in shops %}
                    <option value="{{ shop.id }}" {{ 'selected' if request.args.get('shop_id') == shop.id|string }}>{{ shop.shop_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">ğŸ” æœç´¢</button>
                <a href="{{ url_for('order.order_list') }}" class="btn">é‡ç½®</a>
            </div>
        </div>
    </form>

    <!-- è®¢å•åˆ—è¡¨ -->
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>è®¢å•å·</th>
                    <th>äº¬ä¸œè®¢å•å·</th>
                    <th>åº—é“º</th>
                    <th>ç±»å‹</th>
                    <th>çŠ¶æ€</th>
                    <th>å•†å“ä¿¡æ¯</th>
                    <th>é‡‘é¢</th>
                    <th>æ•°é‡</th>
                    <th>åˆ›å»ºæ—¶é—´</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% if orders %}
                    {% for order in orders %}
                    <tr>
                        <td>
                            <a href="{{ url_for('order.order_detail', order_id=order.id) }}">{{ order.order_no }}</a>
                        </td>
                        <td>{{ order.jd_order_no }}</td>
                        <td>
                            {% if order.shop %}
                                {{ order.shop.shop_name }}
                            {% else %}
                                <span class="text-muted">æœªçŸ¥åº—é“º</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if order.shop_type == 1 %}
                                <span class="badge badge-info">æ¸¸æˆç‚¹å¡</span>
                            {% else %}
                                <span class="badge badge-success">é€šç”¨äº¤æ˜“</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if order.order_status == 0 %}
                                <span class="badge badge-warning">â³ å¾…å¤„ç†</span>
                            {% elif order.order_status == 1 %}
                                <span class="badge badge-info">ğŸ”„ å¤„ç†ä¸­</span>
                            {% elif order.order_status == 2 %}
                                <span class="badge badge-success">âœ… å·²å®Œæˆ</span>
                            {% elif order.order_status == 3 %}
                                <span class="badge badge-secondary">âŒ å·²å–æ¶ˆ</span>
                            {% elif order.order_status == 4 %}
                                <span class="badge badge-danger">ğŸ’° å·²é€€æ¬¾</span>
                            {% elif order.order_status == 5 %}
                                <span class="badge badge-error">âš ï¸ å¼‚å¸¸</span>
                            {% else %}
                                <span class="badge">æœªçŸ¥({{ order.order_status }})</span>
                            {% endif %}
                        </td>
                        <td>
                            {{ order.product_info or '-' }}
                        </td>
                        <td>Â¥{{ '%.2f'|format(order.amount / 100) }}</td>
                        <td>{{ order.quantity }}</td>
                        <td>{{ order.create_time.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            <a href="{{ url_for('order.order_detail', order_id=order.id) }}" class="btn btn-sm">æŸ¥çœ‹</a>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="10" class="text-center text-muted">æš‚æ— è®¢å•æ•°æ®</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- åˆ†é¡µ -->
    {% if pagination.pages > 1 %}
    <div class="pagination">
        {% if pagination.has_prev %}
            <a href="{{ url_for('order.order_list', page=pagination.prev_num, **request.args) }}" class="page-link">ä¸Šä¸€é¡µ</a>
        {% endif %}

        {% for page in pagination.iter_pages() %}
            {% if page %}
                {% if page == pagination.page %}
                    <span class="page-link active">{{ page }}</span>
                {% else %}
                    <a href="{{ url_for('order.order_list', page=page, **request.args) }}" class="page-link">{{ page }}</a>
                {% endif %}
            {% else %}
                <span class="page-link">...</span>
            {% endif %}
        {% endfor %}

        {% if pagination.has_next %}
            <a href="{{ url_for('order.order_list', page=pagination.next_num, **request.args) }}" class="page-link">ä¸‹ä¸€é¡µ</a>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
.badge {
    padding: 4px 8px;
    border-radius: 3px;
    font-size: 12px;
    font-weight: 500;
}
.badge-warning {
    background: #faad14;
    color: white;
}
.badge-info {
    background: #1890ff;
    color: white;
}
.badge-success {
    background: #52c41a;
    color: white;
}
.badge-secondary {
    background: #8c8c8c;
    color: white;
}
.badge-danger {
    background: #ff4d4f;
    color: white;
}
.badge-error {
    background: #fa541c;
    color: white;
}
.table-responsive {
    overflow-x: auto;
}
.table {
    width: 100%;
    border-collapse: collapse;
}
.table th,
.table td {
    padding: 12px;
    border-bottom: 1px solid #f0f0f0;
    text-align: left;
}
.table th {
    background: #fafafa;
    font-weight: 600;
}
.table tbody tr:hover {
    background: #f5f5f5;
}
.pagination {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-top: 20px;
}
.page-link {
    padding: 8px 12px;
    border: 1px solid #d9d9d9;
    border-radius: 4px;
    text-decoration: none;
    color: #333;
}
.page-link:hover {
    background: #f0f0f0;
}
.page-link.active {
    background: #1890ff;
    color: white;
    border-color: #1890ff;
}
</style>
{% endblock %}
