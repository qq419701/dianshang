# å®å¡”é¢æ¿éƒ¨ç½²æ•™ç¨‹ â€” ç”µå•†å¹³å°ç®¡ç†ç³»ç»Ÿ

> **é€‚ç”¨ç¯å¢ƒ**ï¼šCentOS 7/8ã€Ubuntu 18.04/20.04/22.04  
> **å®å¡”é¢æ¿ç‰ˆæœ¬**ï¼šâ‰¥ 7.x  
> **Python ç‰ˆæœ¬**ï¼šâ‰¥ 3.8  

---

## ç›®å½•

1. [å‡†å¤‡å·¥ä½œ](#1-å‡†å¤‡å·¥ä½œ)
2. [å®‰è£…å®å¡”é¢æ¿](#2-å®‰è£…å®å¡”é¢æ¿)
3. [å®‰è£…è¿è¡Œç¯å¢ƒ](#3-å®‰è£…è¿è¡Œç¯å¢ƒ)
4. [ä¸Šä¼ é¡¹ç›®ä»£ç ](#4-ä¸Šä¼ é¡¹ç›®ä»£ç )
5. [é…ç½®æ•°æ®åº“](#5-é…ç½®æ•°æ®åº“)
6. [é…ç½® Python ç¯å¢ƒ](#6-é…ç½®-python-ç¯å¢ƒ)
7. [é…ç½® Nginx åå‘ä»£ç†](#7-é…ç½®-nginx-åå‘ä»£ç†)
8. [é…ç½® SSL è¯ä¹¦](#8-é…ç½®-ssl-è¯ä¹¦)
9. [å¯åŠ¨åº”ç”¨æœåŠ¡](#9-å¯åŠ¨åº”ç”¨æœåŠ¡)
10. [é…ç½®å¼€æœºè‡ªå¯](#10-é…ç½®å¼€æœºè‡ªå¯)
11. [éªŒè¯éƒ¨ç½²](#11-éªŒè¯éƒ¨ç½²)
12. [æ—¥å¸¸è¿ç»´](#12-æ—¥å¸¸è¿ç»´)

---

## 1. å‡†å¤‡å·¥ä½œ

### 1.1 æœåŠ¡å™¨è¦æ±‚

| é¡¹ç›® | æœ€ä½é…ç½® | æ¨èé…ç½® |
|------|---------|---------|
| CPU | 1æ ¸ | 2æ ¸+ |
| å†…å­˜ | 1GB | 2GB+ |
| ç¡¬ç›˜ | 20GB | 40GB+ |
| å¸¦å®½ | 1Mbps | 5Mbps+ |
| ç³»ç»Ÿ | CentOS 7 / Ubuntu 18.04 | CentOS 8 / Ubuntu 22.04 |

### 1.2 éœ€è¦å‡†å¤‡çš„ä¿¡æ¯

- æœåŠ¡å™¨ IP åœ°å€å’Œ SSH å¯†ç 
- å·²å¤‡æ¡ˆçš„åŸŸåï¼ˆç”¨äº HTTPS è¯ä¹¦ï¼‰
- äº¬ä¸œå¹³å°åˆ†é…çš„å•†å®¶IDå’Œå¯†é’¥ï¼ˆä»äº¬ä¸œå•†å®¶åå°è·å–ï¼‰

---

## 2. å®‰è£…å®å¡”é¢æ¿

### 2.1 SSH è¿æ¥æœåŠ¡å™¨

ä½¿ç”¨ç»ˆç«¯å·¥å…·ï¼ˆå¦‚ PuTTYã€Xshell æˆ– Mac ç»ˆç«¯ï¼‰è¿æ¥æœåŠ¡å™¨ï¼š

```bash
ssh root@ä½ çš„æœåŠ¡å™¨IP
```

### 2.2 å®‰è£…å®å¡”é¢æ¿

**CentOS ç³»ç»Ÿï¼š**
```bash
yum install -y wget && wget -O install.sh https://download.bt.cn/install/install_6.0.sh && sh install.sh ed8484bec
```

**Ubuntu ç³»ç»Ÿï¼š**
```bash
wget -O install.sh https://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh ed8484bec
```

### 2.3 è®°å½•é¢æ¿ä¿¡æ¯

å®‰è£…å®Œæˆåï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºï¼š

```
==================================================================
æ­å–œï¼Œå®å¡”é¢æ¿å®‰è£…æˆåŠŸï¼
==================================================================
å¤–ç½‘é¢æ¿åœ°å€: http://ä½ çš„IP:8888/xxxxxxx
å†…ç½‘é¢æ¿åœ°å€: http://å†…ç½‘IP:8888/xxxxxxx
username: xxxxxxxx
password: xxxxxxxx
```

> âš ï¸ **è¯·åŠ¡å¿…è®°å½•å¥½é¢æ¿åœ°å€ã€ç”¨æˆ·åå’Œå¯†ç ï¼**

### 2.4 ç™»å½•å®å¡”é¢æ¿

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®é¢æ¿åœ°å€ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚

---

## 3. å®‰è£…è¿è¡Œç¯å¢ƒ

### 3.1 é¦–æ¬¡ç™»å½•å®‰è£…å¥—ä»¶

é¦–æ¬¡ç™»å½•å®å¡”é¢æ¿æ—¶ï¼Œä¼šå¼¹å‡ºæ¨èå®‰è£…å¥—ä»¶ï¼Œé€‰æ‹©ï¼š

- âœ… **Nginx**ï¼ˆæ¨è 1.22+ï¼‰
- âœ… **MySQL 5.7**ï¼ˆæˆ– 8.0ï¼‰
- âœ… **Pure-Ftpd**ï¼ˆå¯é€‰ï¼‰
- âŒ PHPï¼ˆæœ¬é¡¹ç›®ä¸éœ€è¦ï¼‰
- âŒ Apacheï¼ˆä½¿ç”¨ Nginxï¼‰

ç‚¹å‡» **ã€Œä¸€é”®å®‰è£…ã€**ï¼Œç­‰å¾…å®‰è£…å®Œæˆï¼ˆçº¦5-15åˆ†é’Ÿï¼‰ã€‚

### 3.2 å®‰è£… Python é¡¹ç›®ç®¡ç†å™¨

1. ç‚¹å‡»å·¦ä¾§èœå• **ã€Œè½¯ä»¶å•†åº—ã€**
2. æœç´¢ **ã€ŒPythoné¡¹ç›®ç®¡ç†å™¨ã€**
3. ç‚¹å‡» **ã€Œå®‰è£…ã€**

> ğŸ’¡ Python é¡¹ç›®ç®¡ç†å™¨å¯ä»¥æ–¹ä¾¿åœ°ç®¡ç† Python è™šæ‹Ÿç¯å¢ƒå’Œ Gunicorn è¿›ç¨‹ã€‚

### 3.3 å®‰è£… Python 3.10+

1. åœ¨ Python é¡¹ç›®ç®¡ç†å™¨ä¸­ï¼Œç‚¹å‡» **ã€Œç‰ˆæœ¬ç®¡ç†ã€**
2. é€‰æ‹©å®‰è£… **Python 3.10**ï¼ˆæˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
3. ç­‰å¾…ç¼–è¯‘å®‰è£…å®Œæˆ

---

## 4. ä¸Šä¼ é¡¹ç›®ä»£ç 

### 4.1 åˆ›å»ºç½‘ç«™ç›®å½•

1. ç‚¹å‡»å·¦ä¾§èœå• **ã€Œæ–‡ä»¶ã€**
2. è¿›å…¥ `/www/wwwroot/` ç›®å½•
3. ç‚¹å‡» **ã€Œæ–°å»ºæ–‡ä»¶å¤¹ã€**ï¼Œå‘½åä¸º `dianshang`

### 4.2 ä¸Šä¼ é¡¹ç›®æ–‡ä»¶

**æ–¹å¼ä¸€ï¼šå®å¡”é¢æ¿ä¸Šä¼ **

1. è¿›å…¥ `/www/wwwroot/dianshang/` ç›®å½•
2. ç‚¹å‡» **ã€Œä¸Šä¼ ã€**
3. é€‰æ‹©é¡¹ç›®çš„å‹ç¼©åŒ…ä¸Šä¼ 
4. ä¸Šä¼ åå³é”®è§£å‹

**æ–¹å¼äºŒï¼šGit æ‹‰å–ï¼ˆæ¨èï¼‰**

```bash
# SSH è¿æ¥æœåŠ¡å™¨åæ‰§è¡Œ
cd /www/wwwroot/
git clone https://github.com/ä½ çš„ç”¨æˆ·å/dianshang.git
```

### 4.3 é¡¹ç›®æ–‡ä»¶ç»“æ„ç¡®è®¤

ä¸Šä¼ å®Œæˆåï¼Œç¡®è®¤ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
/www/wwwroot/dianshang/
â”œâ”€â”€ app/                    # åº”ç”¨ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py         # Flask åº”ç”¨å·¥å‚
â”‚   â”œâ”€â”€ models/             # æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ routes/             # è·¯ç”±æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ utils/              # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ templates/          # é¡µé¢æ¨¡æ¿
â”‚   â””â”€â”€ static/             # é™æ€èµ„æº
â”œâ”€â”€ config.py               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ run.py                  # å¯åŠ¨å…¥å£
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–
â”œâ”€â”€ init_db.sql             # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ .env.example            # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ ...
```

---

## 5. é…ç½®æ•°æ®åº“

### 5.1 åˆ›å»ºæ•°æ®åº“

1. ç‚¹å‡»å·¦ä¾§èœå• **ã€Œæ•°æ®åº“ã€**
2. ç‚¹å‡» **ã€Œæ·»åŠ æ•°æ®åº“ã€**
3. å¡«å†™ä¿¡æ¯ï¼š
   - æ•°æ®åº“åï¼š`dianshang`
   - ç”¨æˆ·åï¼š`dianshang`
   - å¯†ç ï¼šï¼ˆè‡ªåŠ¨ç”Ÿæˆæˆ–è‡ªå®šä¹‰ï¼Œ**è¯·è®°å½•æ­¤å¯†ç **ï¼‰
   - è®¿é—®æƒé™ï¼šæœ¬åœ°æœåŠ¡å™¨
4. ç‚¹å‡» **ã€Œæäº¤ã€**

### 5.2 å¯¼å…¥æ•°æ®åº“ç»“æ„

1. åœ¨æ•°æ®åº“åˆ—è¡¨ä¸­æ‰¾åˆ° `dianshang`
2. ç‚¹å‡» **ã€Œå¯¼å…¥ã€**
3. é€‰æ‹©é¡¹ç›®ä¸­çš„ `init_db.sql` æ–‡ä»¶
4. ç‚¹å‡» **ã€Œå¯¼å…¥ã€** æ‰§è¡Œ

> ğŸ’¡ ä¹Ÿå¯ä»¥é€šè¿‡ SSH å‘½ä»¤è¡Œå¯¼å…¥ï¼š
> ```bash
> mysql -u dianshang -p dianshang < /www/wwwroot/dianshang/init_db.sql
> ```

### 5.3 éªŒè¯æ•°æ®åº“

åœ¨ **phpMyAdmin** æˆ–ç»ˆç«¯ä¸­æ£€æŸ¥æ˜¯å¦æˆåŠŸåˆ›å»ºäº†ä»¥ä¸‹5å¼ è¡¨ï¼š

- `merchant_jd_config` â€” å•†æˆ·äº¬ä¸œé…ç½®è¡¨
- `agiso_config` â€” é˜¿å¥‡ç´¢å¼€æ”¾å¹³å°é…ç½®è¡¨
- `orders` â€” è®¢å•ä¸»è¡¨
- `jd_callbacks` â€” äº¬ä¸œå›è°ƒè®°å½•è¡¨
- `agiso_logs` â€” é˜¿å¥‡ç´¢è°ƒç”¨æ—¥å¿—è¡¨

---

## 6. é…ç½® Python ç¯å¢ƒ

### 6.1 åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

1. åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­è¿›å…¥ `/www/wwwroot/dianshang/`
2. å¤åˆ¶ `.env.example` ä¸º `.env`
3. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```ini
# æ•°æ®åº“é…ç½®ï¼ˆå¡«å†™æ­¥éª¤5ä¸­åˆ›å»ºçš„æ•°æ®åº“ä¿¡æ¯ï¼‰
DB_HOST=127.0.0.1
DB_PORT=3306
DB_NAME=dianshang
DB_USER=dianshang
DB_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 

# Flask å¯†é’¥ï¼ˆéšæœºç”Ÿæˆä¸€ä¸²å­—ç¬¦ï¼‰
SECRET_KEY=è¯·æ›¿æ¢ä¸ºéšæœºå­—ç¬¦ä¸²

# è¿è¡Œç¯å¢ƒ
FLASK_ENV=production
FLASK_PORT=5000

# ç³»ç»Ÿ AES å¯†é’¥ï¼ˆç”¨äºåŠ å¯†å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œå¿…é¡»32å­—èŠ‚ï¼‰
# âš ï¸ éƒ¨ç½²åè¯·å‹¿ä¿®æ”¹æ­¤å¯†é’¥ï¼Œå¦åˆ™å·²åŠ å¯†æ•°æ®å°†æ— æ³•è§£å¯†
SYSTEM_AES_KEY=è¯·æ›¿æ¢ä¸º32å­—èŠ‚çš„éšæœºå­—ç¬¦ä¸²
```

> âš ï¸ **å®‰å…¨æé†’**ï¼š`.env` æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œè¯·ç¡®ä¿ä¸è¦ä¸Šä¼ åˆ°å…¬å¼€ä»“åº“ï¼

### 6.2 åˆ›å»º Python é¡¹ç›®

1. ç‚¹å‡»å·¦ä¾§èœå• **ã€Œè½¯ä»¶å•†åº—ã€** â†’ **ã€ŒPythoné¡¹ç›®ç®¡ç†å™¨ã€** â†’ **ã€Œè®¾ç½®ã€**
2. ç‚¹å‡» **ã€Œæ·»åŠ é¡¹ç›®ã€**
3. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - é¡¹ç›®åç§°ï¼š`dianshang`
   - é¡¹ç›®è·¯å¾„ï¼š`/www/wwwroot/dianshang`
   - Pythonç‰ˆæœ¬ï¼šé€‰æ‹©å·²å®‰è£…çš„ 3.10+
   - æ¡†æ¶ï¼š`flask`
   - å¯åŠ¨æ–¹å¼ï¼š`gunicorn`
   - å¯åŠ¨æ–‡ä»¶ï¼š`run:app`
   - ç«¯å£ï¼š`5000`
   - è¿è¡Œç”¨æˆ·ï¼š`www`
4. ç‚¹å‡» **ã€Œç¡®å®šã€**

### 6.3 å®‰è£…ä¾èµ–

åœ¨ Python é¡¹ç›®ç®¡ç†å™¨ä¸­ï¼Œé€‰æ‹© `dianshang` é¡¹ç›®ï¼Œç‚¹å‡» **ã€Œæ¨¡å—ã€**ï¼Œç„¶åç‚¹å‡» **ã€Œä» requirements.txt å®‰è£…ã€**ã€‚

æˆ–è€…é€šè¿‡ SSH æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/dianshang
# è¿›å…¥è™šæ‹Ÿç¯å¢ƒ
source /www/wwwroot/dianshang/venv/bin/activate
# å®‰è£…ä¾èµ–
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

---

## 7. é…ç½® Nginx åå‘ä»£ç†

### 7.1 æ·»åŠ ç«™ç‚¹

1. ç‚¹å‡»å·¦ä¾§èœå• **ã€Œç½‘ç«™ã€**
2. ç‚¹å‡» **ã€Œæ·»åŠ ç«™ç‚¹ã€**
3. å¡«å†™ä¿¡æ¯ï¼š
   - åŸŸåï¼š`yourdomain.com`ï¼ˆå¡«å†™ä½ çš„å®é™…åŸŸåï¼‰
   - æ ¹ç›®å½•ï¼š`/www/wwwroot/dianshang`
   - PHPç‰ˆæœ¬ï¼šé€‰æ‹©ã€Œçº¯é™æ€ã€
4. ç‚¹å‡» **ã€Œæäº¤ã€**

### 7.2 é…ç½®åå‘ä»£ç†

1. åœ¨ç«™ç‚¹åˆ—è¡¨ä¸­ï¼Œç‚¹å‡»åŸŸåè¿›å…¥è®¾ç½®
2. ç‚¹å‡» **ã€Œåå‘ä»£ç†ã€**
3. ç‚¹å‡» **ã€Œæ·»åŠ åå‘ä»£ç†ã€**
4. å¡«å†™ä¿¡æ¯ï¼š
   - ä»£ç†åç§°ï¼š`dianshang`
   - ç›®æ ‡URLï¼š`http://127.0.0.1:5000`
   - å‘é€åŸŸåï¼š`$host`
5. ç‚¹å‡» **ã€Œç¡®å®šã€**

### 7.3 è‡ªå®šä¹‰ Nginx é…ç½®ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰

ç‚¹å‡»ç«™ç‚¹è®¾ç½®ä¸­çš„ **ã€Œé…ç½®æ–‡ä»¶ã€**ï¼Œæ·»åŠ ä»¥ä¸‹ä¼˜åŒ–é…ç½®ï¼š

```nginx
# åœ¨ server å—å†…æ·»åŠ 

# è¯·æ±‚è¶…æ—¶è®¾ç½®ï¼ˆäº¬ä¸œæ¥å£æœ‰æ€§èƒ½è¦æ±‚ï¼‰
proxy_connect_timeout 5s;
proxy_read_timeout 30s;
proxy_send_timeout 30s;

# çœŸå® IP é€ä¼ 
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;

# é™æ€æ–‡ä»¶ç›´æ¥ç”± Nginx æä¾›
location /static/ {
    alias /www/wwwroot/dianshang/app/static/;
    expires 7d;
    access_log off;
}
```

---

## 8. é…ç½® SSL è¯ä¹¦

### 8.1 ç”³è¯·å…è´¹ SSL è¯ä¹¦

1. åœ¨ç«™ç‚¹è®¾ç½®ä¸­ï¼Œç‚¹å‡» **ã€ŒSSLã€**
2. ç‚¹å‡» **ã€ŒLet's Encryptã€**
3. å‹¾é€‰ä½ çš„åŸŸå
4. ç‚¹å‡» **ã€Œç”³è¯·ã€**

> ğŸ’¡ ç”³è¯·å‰è¯·ç¡®ä¿åŸŸåå·²è§£æåˆ°æœåŠ¡å™¨IPã€‚

### 8.2 å¼€å¯å¼ºåˆ¶ HTTPS

è¯ä¹¦ç”³è¯·æˆåŠŸåï¼š

1. å¼€å¯ **ã€Œå¼ºåˆ¶HTTPSã€** å¼€å…³
2. è¿™æ ·æ‰€æœ‰ HTTP è¯·æ±‚ä¼šè‡ªåŠ¨è·³è½¬åˆ° HTTPS

> âš ï¸ äº¬ä¸œå¹³å°è¦æ±‚æ¥å£åœ°å€å¿…é¡»ä¸º HTTPSï¼

---

## 9. å¯åŠ¨åº”ç”¨æœåŠ¡

### 9.1 é€šè¿‡ Python é¡¹ç›®ç®¡ç†å™¨å¯åŠ¨

1. è¿›å…¥ **ã€ŒPythoné¡¹ç›®ç®¡ç†å™¨ã€**
2. æ‰¾åˆ° `dianshang` é¡¹ç›®
3. ç‚¹å‡» **ã€Œå¯åŠ¨ã€** æŒ‰é’®

### 9.2 é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨ï¼ˆè°ƒè¯•ç”¨ï¼‰

```bash
cd /www/wwwroot/dianshang
source venv/bin/activate

# å¼€å‘æ¨¡å¼å¯åŠ¨ï¼ˆä»…è°ƒè¯•ç”¨ï¼‰
python run.py

# ç”Ÿäº§æ¨¡å¼å¯åŠ¨ï¼ˆæ¨èï¼‰
gunicorn -w 4 -b 127.0.0.1:5000 run:app
```

### 9.3 Gunicorn é…ç½®ä¼˜åŒ–

åˆ›å»º `gunicorn.conf.py` æ–‡ä»¶ï¼š

```python
# Gunicorn ç”Ÿäº§ç¯å¢ƒé…ç½®
bind = "127.0.0.1:5000"    # ç›‘å¬åœ°å€å’Œç«¯å£
workers = 4                 # å·¥ä½œè¿›ç¨‹æ•°ï¼ˆå»ºè®® CPUæ ¸æ•° Ã— 2 + 1ï¼‰
threads = 2                 # æ¯ä¸ªè¿›ç¨‹çš„çº¿ç¨‹æ•°
timeout = 30                # è¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰
accesslog = "/www/wwwlogs/dianshang_access.log"   # è®¿é—®æ—¥å¿—
errorlog = "/www/wwwlogs/dianshang_error.log"      # é”™è¯¯æ—¥å¿—
loglevel = "info"           # æ—¥å¿—çº§åˆ«
```

å¯åŠ¨å‘½ä»¤æ”¹ä¸ºï¼š

```bash
gunicorn -c gunicorn.conf.py run:app
```

---

## 10. é…ç½®å¼€æœºè‡ªå¯

### 10.1 å®å¡”è‡ªåŠ¨ç®¡ç†

å¦‚æœä½¿ç”¨ Python é¡¹ç›®ç®¡ç†å™¨åˆ›å»ºçš„é¡¹ç›®ï¼Œå®å¡”ä¼šè‡ªåŠ¨ç®¡ç†è¿›ç¨‹çš„å¯åŠ¨å’Œé‡å¯ã€‚

### 10.2 æ‰‹åŠ¨é…ç½® Systemd æœåŠ¡

å¦‚éœ€æ‰‹åŠ¨é…ç½®ï¼Œåˆ›å»ºç³»ç»ŸæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo nano /etc/systemd/system/dianshang.service
```

å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=ç”µå•†å¹³å°ç®¡ç†ç³»ç»Ÿ
After=network.target mysql.service

[Service]
Type=simple
User=www
Group=www
WorkingDirectory=/www/wwwroot/dianshang
Environment="PATH=/www/wwwroot/dianshang/venv/bin"
ExecStart=/www/wwwroot/dianshang/venv/bin/gunicorn -c gunicorn.conf.py run:app
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl enable dianshang
sudo systemctl start dianshang
```

---

## 11. éªŒè¯éƒ¨ç½²

### 11.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€

åœ¨å®å¡”é¢æ¿çš„ Python é¡¹ç›®ç®¡ç†å™¨ä¸­ï¼Œç¡®è®¤é¡¹ç›®çŠ¶æ€ä¸º **ã€Œè¿è¡Œä¸­ã€**ï¼ˆç»¿è‰²æ ‡è¯†ï¼‰ã€‚

### 11.2 è®¿é—®ç®¡ç†åå°

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š

```
https://yourdomain.com/admin/
```

åº”è¯¥çœ‹åˆ°ä¸­æ–‡ç®¡ç†ç•Œé¢çš„ä»ªè¡¨ç›˜é¡µé¢ï¼ŒåŒ…å«ï¼š
- ğŸ“Š æ•°æ®æ¦‚è§ˆï¼ˆæ€»è®¢å•æ•°ã€ä»Šæ—¥è®¢å•ç­‰ç»Ÿè®¡ï¼‰
- ğŸ“ƒ æœ€è¿‘è®¢å•åˆ—è¡¨

### 11.3 æµ‹è¯•æ¥å£åœ°å€

åœ¨ç®¡ç†åå°çš„ **ã€Œç³»ç»Ÿé…ç½®ã€** é¡µé¢ï¼š

1. åœ¨ **ã€Œæ¥å£åœ°å€ç”Ÿæˆå™¨ã€** ä¸­è¾“å…¥ä½ çš„åŸŸå
2. ç‚¹å‡» **ã€Œç”Ÿæˆåœ°å€ã€**
3. å°†ç”Ÿæˆçš„æ¥å£åœ°å€æäº¤ç»™äº¬ä¸œå¹³å°

### 11.4 æ¥å£è¿é€šæ€§æµ‹è¯•

ä½¿ç”¨ curl å‘½ä»¤æµ‹è¯•æ¥å£æ˜¯å¦å¯è®¿é—®ï¼š

```bash
# æµ‹è¯•é€šç”¨äº¤æ˜“æ¥å£
curl -X POST https://yourdomain.com/api/jd/general/beginDistill

# æµ‹è¯•æ¸¸æˆç‚¹å¡æ¥å£
curl -X POST https://yourdomain.com/api/jd/game/preCheck

# æµ‹è¯•ç®¡ç†åå°
curl https://yourdomain.com/admin/
```

---

## 12. æ—¥å¸¸è¿ç»´

### 12.1 æŸ¥çœ‹æ—¥å¿—

**åº”ç”¨æ—¥å¿—ï¼š**
```bash
tail -f /www/wwwlogs/dianshang_access.log
tail -f /www/wwwlogs/dianshang_error.log
```

**Nginx æ—¥å¿—ï¼š**
```bash
tail -f /www/wwwlogs/yourdomain.com.log
tail -f /www/wwwlogs/yourdomain.com.error.log
```

### 12.2 é‡å¯åº”ç”¨

**æ–¹å¼ä¸€ï¼š** å®å¡” Python é¡¹ç›®ç®¡ç†å™¨ä¸­ç‚¹å‡» **ã€Œé‡å¯ã€**

**æ–¹å¼äºŒï¼š** å‘½ä»¤è¡Œæ‰§è¡Œ
```bash
sudo systemctl restart dianshang
```

### 12.3 æ›´æ–°ä»£ç 

```bash
cd /www/wwwroot/dianshang
git pull origin main

# é‡å¯åº”ç”¨ä½¿æ›´æ–°ç”Ÿæ•ˆ
# åœ¨å®å¡”é¢æ¿ä¸­é‡å¯é¡¹ç›®ï¼Œæˆ–æ‰§è¡Œï¼š
sudo systemctl restart dianshang
```

### 12.4 æ•°æ®åº“å¤‡ä»½

1. ç‚¹å‡»å®å¡”é¢æ¿å·¦ä¾§ **ã€Œè®¡åˆ’ä»»åŠ¡ã€**
2. æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼š
   - ä»»åŠ¡ç±»å‹ï¼š**å¤‡ä»½æ•°æ®åº“**
   - æ•°æ®åº“åï¼š`dianshang`
   - å¤‡ä»½å‘¨æœŸï¼šæ¯å¤©å‡Œæ™¨ 3:00
   - ä¿ç•™ä»½æ•°ï¼š7

### 12.5 å®‰å…¨å»ºè®®

| é¡¹ç›® | æ“ä½œ |
|------|------|
| å®å¡”é¢æ¿ç«¯å£ | ä¿®æ”¹é»˜è®¤ 8888 ç«¯å£ä¸ºå…¶ä»–ç«¯å£ |
| SSH ç«¯å£ | ä¿®æ”¹é»˜è®¤ 22 ç«¯å£ |
| é¢æ¿å…¥å£ | è®¾ç½®å®‰å…¨å…¥å£è·¯å¾„ |
| é˜²ç«å¢™ | ä»…å¼€æ”¾ 80ã€443 å’Œè‡ªå®šä¹‰é¢æ¿ç«¯å£ |
| æ•°æ®åº“ | ç¦æ­¢è¿œç¨‹è®¿é—® |
| `.env` æ–‡ä»¶ | è®¾ç½® 600 æƒé™ï¼Œä»… www ç”¨æˆ·å¯è¯» |

```bash
# è®¾ç½® .env æ–‡ä»¶æƒé™
chmod 600 /www/wwwroot/dianshang/.env
chown www:www /www/wwwroot/dianshang/.env
```

---

## å¸¸è§é—®é¢˜

### Q: è®¿é—®é¡µé¢æ˜¾ç¤º 502 Bad Gatewayï¼Ÿ

**A:** æ£€æŸ¥åº”ç”¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š
```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
ps aux | grep gunicorn
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -20 /www/wwwlogs/dianshang_error.log
```

### Q: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ

**A:** æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯å¯†ç ä¸­æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦éœ€è¦è½¬ä¹‰ã€‚

### Q: äº¬ä¸œå›è°ƒé€šçŸ¥æ”¶ä¸åˆ°ï¼Ÿ

**A:** 
1. ç¡®è®¤åŸŸåå·²æ­£ç¡®è§£æ
2. ç¡®è®¤ SSL è¯ä¹¦å·²é…ç½®ä¸”æœªè¿‡æœŸ
3. ç¡®è®¤é˜²ç«å¢™å·²å¼€æ”¾ 443 ç«¯å£
4. åœ¨ç®¡ç†åå°çš„å›è°ƒæ—¥å¿—é¡µé¢æŸ¥çœ‹æ˜¯å¦æœ‰è®°å½•

### Q: å¦‚ä½•æŸ¥çœ‹å¯†é’¥ä¿¡æ¯ï¼Ÿ

**A:** å¯†é’¥ä¿¡æ¯åœ¨æ•°æ®åº“ä¸­ä»¥ AES åŠ å¯†æ–¹å¼å­˜å‚¨ï¼Œå‰ç«¯æ˜¾ç¤ºä¸º `******`ã€‚å¦‚éœ€æŸ¥çœ‹ï¼Œè¯·é€šè¿‡ç®¡ç†åå°å¹¶æä¾›äºŒæ¬¡éªŒè¯ã€‚

---

> ğŸ“ **æ–‡æ¡£ç‰ˆæœ¬**ï¼šV1.0  
> **æœ€åæ›´æ–°**ï¼š2026-02-17
